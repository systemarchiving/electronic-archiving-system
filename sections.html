<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>الأقسام - نظام الأرشفة الإلكترونية</title>
  <style>
    :root {
      --primary:   #186e2b;
      --secondary: #bf9930;
      --light:     #ffffff;
      --dark:      #121212;
      --bg:        #f4f4f4;
      --text:      #333333;
      --text-light:#ffffff;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body {
      font-family:Arial,sans-serif;
      direction:rtl;
      background:var(--bg);
      color:var(--text);
      padding-top:80px;
    }
    header {
      position:fixed;top:0;left:0;right:0;height:60px;
      background:var(--primary);
      color:var(--text-light);
      display:flex;align-items:center;justify-content:center;
      z-index:100;
    }
    header img{height:40px;margin-left:10px;}
    header h1{font-size:1.5rem;}

    nav {
      position:fixed;top:60px;left:0;bottom:0;width:240px;
      background:var(--primary);padding-top:20px;
      box-shadow:2px 0 5px rgba(0,0,0,.1);text-align:left;
    }
    nav a {
      display:flex;align-items:center;padding:12px 20px;
      color:var(--text-light);font-size:.95rem;
      text-decoration:none;transition:background .2s;
    }
    nav a:hover,nav a.active {background:var(--secondary);}
    .icon{margin-left:10px;font-size:1.1rem;}

    .toolbar {
      text-align:center; margin:10px auto;
    }
    .toolbar button {
      margin:0 5px; padding:8px 12px;
      background:var(--secondary);
      color:var(--text-light);
      border:none;border-radius:4px;
      cursor:pointer;
    }

    #cards {
      display:flex;flex-wrap:wrap;gap:12px;
      justify-content:center;margin-top:20px;
    }
    .card {
      background:var(--light);padding:16px;
      border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,.1);
      width:140px;text-align:center;cursor:pointer;
      position:relative;
    }
    .card.selected { border:2px solid var(--primary); }
    .card .del {
      position:absolute;top:4px;right:6px;
      cursor:pointer;color:#c00;
    }

    #files-section {
      margin:30px auto; max-width:800px; text-align:center;
    }
    #files-section h3 { margin-bottom:10px; color:var(--primary); }
    .files-grid {
      display:flex;flex-wrap:wrap;gap:12px;justify-content:center;
    }
    .file-item {
      position:relative; width:120px; padding:8px;
      background:var(--light);border:1px solid #ccc;
      border-radius:6px;text-align:center;cursor:pointer;
      overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
      transition:background .2s,transform .2s;
    }
    .file-item:hover { background:#eee;transform:translateY(-2px); }
    .file-item .del-file {
      position:absolute;top:4px;right:4px;
      background:rgba(255,255,255,.8);
      border-radius:50%;padding:2px 4px;
      cursor:pointer;transition:background .2s;
    }
    .file-item .del-file:hover {
      background:var(--secondary);
      color:var(--text-light);
    }

    #section-details {
      margin:30px auto;
      max-width:800px;
      background:var(--light);
      padding:15px;
      border-radius:8px;
      box-shadow:0 2px 5px rgba(0,0,0,.1);
      text-align:left;
    }
    #section-details h3 {
      font-size:1.1rem; color:var(--primary);
      margin-bottom:8px;
    }
    #section-details p {
      line-height:1.4; color:#555;
    }

    .modal {
      display:none;position:fixed;top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,.5);
      justify-content:center;align-items:center;
      z-index:200;
    }
    .modal-content {
      background:var(--light);border-radius:8px;
      padding:20px;width:300px;position:relative;
    }
    .modal-content .close {
      position:absolute;top:10px;right:10px;
      font-size:1.5rem;cursor:pointer;
    }
    .modal-content input,
    .modal-content textarea {
      width:100%;margin:8px 0;padding:6px;
    }

    #file-modal .modal-content {
      width:80%;max-width:600px;height:80%;overflow:auto;
    }
    #file-preview, #img-preview {
      width:100%;height:100%;border:none;
    }

    footer {
      position:fixed;bottom:0;left:240px;right:0;height:40px;
      background:var(--primary);
      color:var(--text-light);
      display:flex;align-items:center;justify-content:center;
      font-size:.85rem;z-index:100;
    }
    body.dark-mode {
      background:var(--dark);color:var(--text-light);
    }
    body.dark-mode header,
    body.dark-mode nav,
    body.dark-mode footer {
      background:#0f4318;
    }
  </style>
</head>
<body>

  <!-- رأس وناف بار -->
  <header>
    <img src="ber-ALmedinh.png" alt="شعار الجمعية">
    <h1>نظام الأرشفة الإلكترونية</h1>
  </header>
  <nav>
    <a href="main.html"><span class="icon">🏠</span>الرئيسية</a>
    <a href="sections.html" class="active"><span class="icon">📁</span>الأقسام</a>
    <a href="archive.html"><span class="icon">📂</span>الأرشيف</a>
    <a href="users.html"><span class="icon">👤</span>المستخدمون</a>
    <a href="settings.html"><span class="icon">⚙️</span>الإعدادات</a>
  </nav>

  <!-- شريط الأدوات -->
  <div class="toolbar">
    <button id="add-section-btn">إضافة قسم</button>
    <button id="edit-section-btn" disabled>تعديل قسم</button>
    <button id="delete-section-btn" disabled>حذف قسم</button>
    <button id="attach-file-btn" disabled>إرفاق ملف</button>
    <input type="file" id="file-input" style="display:none" multiple>
  </div>

  <!-- بطاقات الأقسام -->
  <div id="cards"></div>

  <!-- عرض ملفات القسم المحدد -->
  <div id="files-section">
    <h3>الملفات في القسم</h3>
    <div class="files-grid" id="files-list"></div>
  </div>

  <!-- تفاصيل القسم -->
  <div id="section-details">
    <h3>تفاصيل القسم</h3>
    <p id="section-description">لم يتم اختيار قسم.</p>
  </div>

  <!-- مودال إضافة/تعديل القسم -->
  <div id="section-modal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="section-modal">&times;</span>
      <h3 id="modal-title">إضافة قسم</h3>
      <input type="text" id="sec-name" placeholder="اسم القسم"/>
      <textarea id="sec-desc" placeholder="الوصف (اختياري)"></textarea>
      <button id="save-section-btn">حفظ</button>
    </div>
  </div>

  <!-- مودال معاينة الملف -->
  <div id="file-modal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="file-modal">&times;</span>
      <iframe id="file-preview" style="display:none;"></iframe>
      <img id="img-preview" style="display:none;object-fit:contain;"/>
    </div>
  </div>

  <!-- فوتر -->
  <footer>جميع الحقوق محفوظة © 2025 الجمعية</footer>

  <script>
    // قراءة البيانات محلياً
    let sections = JSON.parse(localStorage.getItem('sections')||'[]');
    let files    = JSON.parse(localStorage.getItem('files')   ||'[]');
    let selectedId = null, editingId = null;

    // عناصر DOM
    const cardsEl      = document.getElementById('cards');
    const addBtn       = document.getElementById('add-section-btn');
    const editBtn      = document.getElementById('edit-section-btn');
    const deleteBtn    = document.getElementById('delete-section-btn');
    const attachBtn    = document.getElementById('attach-file-btn');
    const fileInput    = document.getElementById('file-input');

    const sectionModal = document.getElementById('section-modal');
    const modalTitle   = document.getElementById('modal-title');
    const inpName      = document.getElementById('sec-name');
    const inpDesc      = document.getElementById('sec-desc');
    const saveSection  = document.getElementById('save-section-btn');

    const fileModal    = document.getElementById('file-modal');
    const iframePrev   = document.getElementById('file-preview');
    const imgPrev      = document.getElementById('img-preview');
    const closeEls     = document.querySelectorAll('.close');

    const filesListEl      = document.getElementById('files-list');
    const detailDescEl     = document.getElementById('section-description');

    // حفظ إلى localStorage
    function persist() {
      localStorage.setItem('sections', JSON.stringify(sections));
      localStorage.setItem('files', JSON.stringify(files));
    }

    // رسم بطاقات الأقسام
    function renderSections() {
      cardsEl.innerHTML = '';
      sections.forEach(sec => {
        const card = document.createElement('div');
        card.className = 'card' + (sec.id===selectedId?' selected':'');
        card.innerHTML = `
          <span class="del" data-id="${sec.id}">&times;</span>
          <h4>${sec.name}</h4>
        `;
        card.onclick = () => selectSection(sec.id);
        cardsEl.appendChild(card);
      });
      editBtn.disabled = deleteBtn.disabled = attachBtn.disabled = !selectedId;
      renderFiles();
      renderDetails();
      // زر × لحذف قسم بسرعة
      cardsEl.querySelectorAll('.del').forEach(el=>{
        el.onclick = e=>{
          e.stopPropagation();
          deleteById(+el.dataset.id);
        };
      });
    }

    // اختيار قسم
    function selectSection(id) {
      selectedId = (selectedId===id? null:id);
      renderSections();
    }

    // عرض الملفات في القسم
    function renderFiles() {
      filesListEl.innerHTML = '';
      if (!selectedId) return;
      const secFiles = files.filter(f => f.sectionId===selectedId);
      if (!secFiles.length) {
        filesListEl.innerHTML = '<p>لا توجد ملفات في هذا القسم.</p>';
        return;
      }
      secFiles.forEach(f => {
        const div = document.createElement('div');
        div.className = 'file-item';
        div.innerHTML = `
          <span class="del-file" data-id="${f.id}">&times;</span>
          ${f.filename}
        `;
        div.onclick = ()=> previewFile(f);
        filesListEl.appendChild(div);
      });
      // حذف ملف
      filesListEl.querySelectorAll('.del-file').forEach(el=>{
        el.onclick = e=>{
          e.stopPropagation();
          const id = +el.dataset.id;
          if(confirm('حذف الملف؟')) {
            files = files.filter(x=>x.id!==id);
            persist(); renderFiles();
          }
        };
      });
    }

    // عرض وصف القسم
    function renderDetails() {
      if (!selectedId) {
        detailDescEl.textContent = 'لم يتم اختيار قسم.';
        return;
      }
      const sec = sections.find(s=>s.id===selectedId);
      detailDescEl.textContent = sec.description || 'لا يوجد وصف لهذا القسم.';
    }

    // إضافة قسم
    addBtn.onclick = () => {
      editingId = null;
      modalTitle.textContent = 'إضافة قسم';
      inpName.value = '';
      inpDesc.value = '';
      sectionModal.style.display = 'flex';
    };

    // تعديل قسم
    editBtn.onclick = () => {
      const sec = sections.find(s=>s.id===selectedId);
      if(!sec) return;
      editingId = sec.id;
      modalTitle.textContent = 'تعديل قسم';
      inpName.value = sec.name;
      inpDesc.value = sec.description||'';
      sectionModal.style.display = 'flex';
    };

    // حفظ قسم
    saveSection.onclick = () => {
      const name = inpName.value.trim();
      if(!name) return alert('أدخل اسم القسم');
      const desc = inpDesc.value.trim();
      if (editingId) {
        const sec = sections.find(s=>s.id===editingId);
        sec.name = name; sec.description = desc;
      } else {
        sections.push({
          id: Date.now(),
          name,
          description: desc
        });
      }
      persist();
      sectionModal.style.display = 'none';
      renderSections();
    };

    // حذف قسم
    deleteBtn.onclick = () => {
      if (!selectedId) return;
      if (!confirm('حذف القسم؟')) return;
      deleteById(selectedId);
    };
    function deleteById(id) {
      sections = sections.filter(s=>s.id!==id);
      files    = files.filter(f=>f.sectionId!==id);
      if (selectedId===id) selectedId = null;
      persist();
      renderSections();
    }

    // إرفاق ملفات
    attachBtn.onclick = () => fileInput.click();
    fileInput.onchange = e => {
      if (!selectedId) return;
      Array.from(e.target.files).forEach(f => {
        const reader = new FileReader();
        reader.onload = ev => {
          files.push({
            id: Date.now()+Math.random(),
            sectionId: selectedId,
            filename: f.name,
            dataURL: ev.target.result,
            sizeBytes: f.size,
            archivedAt: new Date().toISOString()
          });
          persist(); renderFiles();
        };
        reader.readAsDataURL(f);
      });
      e.target.value = '';
    };

    // معاينة ملف
    function previewFile(f) {
      const isImg = f.dataURL.startsWith('data:image');
      iframePrev.style.display = isImg?'block':'none';
      imgPrev.style.display    = isImg?'block':'none';
      if(isImg) imgPrev.src     = f.dataURL;
      else      iframePrev.src  = f.dataURL;
      fileModal.style.display  = 'flex';
    }

    // إغلاق المودالات
    closeEls.forEach(el=> el.onclick = ()=> el.closest('.modal').style.display = 'none');

    // البداية
    renderSections();
  </script>
</body>
</html>
